# -------------------------------
# SLURM Cgroup Configuration File
# -------------------------------

# Automatically mount the cgroup hierarchy if not already mounted.
# Set to "no" if your OS (e.g., systemd) already handles this and you want to avoid conflicts.
CgroupAutomount=yes

# Optional: override the default cgroup mount point.
# Use /sys/fs/cgroup if using cgroup v1 hierarchies; leave unset for systemd unified (v2) cgroups.
CgroupMountpoint=/sys/fs/cgroup

# Directory where SLURM places the cgroup release agent script.
# This script can perform cleanup when a job finishes.
# Must be writable by the slurm user and exist on compute nodes.
CgroupReleaseAgentDir="/etc/slurm/cgroup"

# Enforce job's CPU core constraints.
# Prevents jobs from using more CPU cores than allocated.
# Recommended: always set to "yes" for isolation and fairness.
ConstrainCores=yes

# Enforce job's physical memory usage (RAM) limits.
# If a job tries to exceed its allocation, it may be killed or throttled.
# Essential for preventing memory overuse and node crashing.
ConstrainRAMSpace=yes

# Enforce job's virtual memory (address space) usage.
# This includes both RAM and swap.
# Leave "no" unless you specifically need to constrain virtual memory.
ConstrainSwapSpace=no

# Bind jobs to the CPUs they are allocated, improving performance and ensuring isolation.
# With "yes", jobs are pinned to specific cores — useful for NUMA-aware workloads.
TaskAffinity=yes

# Location of file listing devices allowed inside job cgroups.
# Prevents jobs from accessing restricted device files (e.g., GPUs, block devices).
# You must create this file separately and list allowed devices (see below).
AllowedDevicesFile=/etc/slurmica/cgroup_allowed_devices_file.conf

# Allow jobs to use up to 100% of their allocated RAM.
# Can be reduced if you want a soft cap (e.g., set to 95 to leave buffer).
AllowedRAMSpace=100

# Allow no swap space for jobs (0 means no extra swap is granted).
# Set >0 if you want to give jobs a swap safety net.
AllowedSwapSpace=0

# Kernel memory is no longer used in most modern Linux systems; this disables its tracking.
# Set to "yes" if your kernel/cgroup layout supports it (usually unnecessary).
AllowedKmemSpace=no

# ---------------------
# Optional Advanced Flags
# ---------------------

# Uncomment to prevent SLURM from using the OOM killer to enforce limits.
# Can be useful in cases where you prefer throttling over job termination.
#OOMKillAllocate=no

# Uncomment if you want to restrict job access to specific devices only.
# You can leave this unset if you're not managing block devices or GPUs.
#ConstrainDevices=no

# Uncomment to log all cgroup actions (for debugging).
# Use only temporarily — generates a lot of log output.
#DebugFlags=CGROUP
